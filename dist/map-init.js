"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,s,i){return s&&t(e.prototype,s),i&&t(e,i),e}}(),Map=function(){function t(e,s,i){_classCallCheck(this,t),this.element=document.getElementById(e);try{var n=this.element.getAttribute("data-config");this.customConfig=JSON.parse(n)}catch(t){this.customConfig=[],console.log(t)}if(this.config={accessToken:"pk.eyJ1Ijoid2lqbmVtZW5qZW1lZSIsImEiOiJjaWgwZjB4ZGwwMGdza3FseW02MWNxcmttIn0.l-4VI25pfA5GKukRQTXnWA",style:"mapbox://styles/wijnemenjemee/cjcywszq502re2sobjc8d1e0z",hostContainer:e,center:[4.9,52.37],zoom:10.2,pitch:0,bearing:0,scrollZoom:!1},this.options={filters:!0,referenceList:!0},this.session={origin:null,destination:null},s){this.config.dataset=JSON.parse(s)}else this.config.dataset={};this._callToAction=document.getElementById("call-to-action"),this._newRoute=document.getElementById("new-route"),this._oldRoute=document.getElementById("old-route"),this.interactionPopup=new InteractionPopup}return _createClass(t,[{key:"init",value:function(){var t=this,e=new MapWebGL(t.config);t._map=e.create(),t._background=new Background(t._map,t.config),t._lines=new Lines(t._map,t.config),t._points=new Points(t._map,t.config),t._map.on("style.load",function(){t._lines.draw(),t._points.drawOrigins(),t._points.drawDestinations(),t._points.drawTransfers(),t._callToAction.innerHTML="Kies een herkomst in uw buurt",t._map.on("click","origins",function(e){t._callToAction.innerHTML="Kies een bestemming in de stad",t._callToAction.style.background=rood,t.session.origin=e.features[0].properties.id;var s=t._map.getFilter("origins"),i=["==","id",t.session.origin];s.push(i),t._map.setFilter("origins",s),t._map.setFilter("destinations",["all",["==","function","bestemming"]])}),t._map.on("click","destinations",function(e){t.session.destination=e.features[0].properties.id,t.session.traject=t.session.origin+"_"+t.session.destination,t._oldRoute.style.opacity=1,console.log(t.session);var s=t._map.getFilter("destinations"),i=["==","id",t.session.destination];s.push(i),t._map.setFilter("destinations",s),t._map.setFilter("bus-old",["all",["==","transport_type","bus"],["==","isNieuw",!1],["==","trajectId",t.session.traject]]),t._map.setFilter("metro-old",["all",["==","transport_type","metro"],["==","isNieuw",!1],["==","trajectId",t.session.traject]]),t._map.setFilter("tram-old",["all",["==","transport_type","tram"],["==","isNieuw",!1],["==","trajectId",t.session.traject]]),t._map.setFilter("transfers",["all",["==","function","overstap"],["==","trajectId",t.session.traject]]),t._setRouteInfo(!1,t.session.traject),t._setBoundingBox(),setTimeout(function(){t._newRoute.style.opacity=1,t._showNew(t.session.traject,t._map),t._setRouteInfo(!0,t.session.traject)},2e3),t._oldRoute.addEventListener("click",function(){t._showOld(t.session.traject,t._map)},!1),t._newRoute.addEventListener("click",function(){t._showNew(t.session.traject,t._map)},!1)})})}},{key:"_showNew",value:function(t,e){e.setFilter("bus-new",["all",["==","transport_type","bus"],["==","isNieuw",!0],["==","trajectId",t]]),e.setFilter("metro-new",["all",["==","transport_type","metro"],["==","isNieuw",!0],["==","trajectId",t]]),e.setFilter("tram-new",["all",["==","transport_type","tram"],["==","isNieuw",!1],["==","trajectId",t]]),e.setFilter("bus-old",["all",["==","transport_type","bus"],["==","isNieuw",!1],["==","trajectId",""]]),e.setFilter("metro-old",["all",["==","transport_type","metro"],["==","isNieuw",!1],["==","trajectId",""]]),e.setFilter("tram-old",["all",["==","transport_type","tram"],["==","isNieuw",!1],["==","trajectId",""]])}},{key:"_showOld",value:function(t,e){e.setFilter("bus-new",["all",["==","transport_type","bus"],["==","isNieuw",!0],["==","trajectId",""]]),e.setFilter("metro-new",["all",["==","transport_type","metro"],["==","isNieuw",!0],["==","trajectId",""]]),e.setFilter("tram-new",["all",["==","transport_type","tram"],["==","isNieuw",!1],["==","trajectId",""]]),e.setFilter("bus-old",["all",["==","transport_type","bus"],["==","isNieuw",!1],["==","trajectId",t]]),e.setFilter("metro-old",["all",["==","transport_type","metro"],["==","isNieuw",!1],["==","trajectId",t]]),e.setFilter("tram-old",["all",["==","transport_type","tram"],["==","isNieuw",!1],["==","trajectId",t]])}},{key:"_setRouteInfo",value:function(t,e){var s=this,i=s._map.querySourceFeatures("lines",{filter:["all",["!has","function"],["==","isNieuw",t],["==","trajectId",e]]}),n=document.createElement("ul"),o=null;i.forEach(function(t){console.log(t.properties),o=document.createElement("li"),o.innerHTML='<div class="title">'+t.properties.transport_type+" "+t.properties.transport_nrs+'</div> <div class="start">'+t.properties.start_naam+'</div><div class="end">'+t.properties.end_naam+'</div><div class="time">'+t.properties.reistijd,n.appendChild(o)}),t?s._newRoute.appendChild(n):s._oldRoute.appendChild(n)}},{key:"_setBoundingBox",value:function(){var t=this,e=t._map.queryRenderedFeatures({layers:["origins","destinations","transfers"]}),s={type:"FeatureCollection",features:e},i=turf.bbox(s);t._map.fitBounds(i,{padding:{top:100,bottom:100,left:100,right:100},linear:!0})}}]),t}();